<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Quality Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 20px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .info-text {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result-card {
            display: none;
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
        }

        .result-card.potable {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .result-card.not-potable {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .result-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .parameter-analysis {
            margin-top: 20px;
        }

        .parameter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .parameter-name {
            font-weight: 600;
            color: #333;
        }

        .parameter-value {
            color: #666;
        }

        .parameter-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-safe {
            background: #d4edda;
            color: #155724;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .health-risks {
            margin: 10px 0 20px 0;
            padding: 15px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 8px;
        }

        .risk-title {
            font-weight: 700;
            color: #856404;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .risk-list {
            margin: 0;
            padding-left: 20px;
            color: #856404;
        }

        .risk-list li {
            margin: 8px 0;
            line-height: 1.5;
        }

        .chart-container {
            margin-top: 30px;
            height: 300px;
        }

        .full-width-card {
            grid-column: 1 / -1;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .info-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .info-box h3 {
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .info-box p {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }
        }

        .sample-btn {
            margin-top: 15px;
            padding: 10px;
            background: #6c757d;
            font-size: 0.9em;
        }

        .sample-btn:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üíß Water Quality Management System</h1>
            <p>Analyze and monitor water quality parameters to predict potability</p>
        </header>

        <div class="main-content">
            <div class="card">
                <h2>üî¨ Water Parameter Input</h2>
                <form id="waterForm">
                    <div class="form-group">
                        <label for="ph">pH Level</label>
                        <input type="number" id="ph" step="0.01" min="0" max="14" required>
                        <div class="info-text">Safe range: 6.5 - 8.5</div>
                    </div>

                    <div class="form-group">
                        <label for="hardness">Hardness (mg/L)</label>
                        <input type="number" id="hardness" step="0.01" min="0" required>
                        <div class="info-text">Safe range: 0 - 300 mg/L</div>
                    </div>

                    <div class="form-group">
                        <label for="organic_carbon">Organic Carbon (ppm)</label>
                        <input type="number" id="organic_carbon" step="0.01" min="0" required>
                        <div class="info-text">Safe range: 0 - 20 ppm</div>
                    </div>

                    <div class="form-group">
                        <label for="conductivity">Conductivity (ŒºS/cm)</label>
                        <input type="number" id="conductivity" step="0.01" min="0" required>
                        <div class="info-text">Safe range: 0 - 800 ŒºS/cm</div>
                    </div>

                    <div class="form-group">
                        <label for="turbidity">Turbidity (NTU)</label>
                        <input type="number" id="turbidity" step="0.01" min="0" required>
                        <div class="info-text">Safe range: 0 - 5 NTU</div>
                    </div>

                    <button type="submit" class="btn">Analyze Water Quality</button>
                    <button type="button" class="btn sample-btn" onclick="fillSampleData()">Load Sample Data</button>
                </form>
            </div>

            <div class="card">
                <h2>üìä Analysis Results</h2>
                
                <div id="resultCard" class="result-card">
                    <div class="result-icon"></div>
                    <div id="resultText"></div>
                </div>

                <div id="parameterAnalysis" class="parameter-analysis" style="display: none;">
                    <h3 style="margin-bottom: 15px; color: #333;">Parameter Status</h3>
                    <div id="parameterList"></div>
                </div>

                <div class="info-grid" style="margin-top: 30px;">
                    <div class="info-box">
                        <h3>Tests Performed</h3>
                        <p id="testCount">0</p>
                    </div>
                    <div class="info-box">
                        <h3>Potable Samples</h3>
                        <p id="potableCount">0</p>
                    </div>
                </div>
            </div>

            <div class="card full-width-card">
                <h2>üìà Historical Trends</h2>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        let testHistory = [];
        let testCount = 0;
        let potableCount = 0;
        let chart = null;

        // Parameter safe ranges
        const safeRanges = {
            ph: { min: 6.5, max: 8.5, unit: '' },
            hardness: { min: 0, max: 300, unit: 'mg/L' },
            organic_carbon: { min: 0, max: 20, unit: 'ppm' },
            conductivity: { min: 0, max: 800, unit: 'ŒºS/cm' },
            turbidity: { min: 0, max: 5, unit: 'NTU' }
        };

        // Health risks database
        const healthRisks = {
            ph: {
                veryLow: { // < 4
                    threshold: 4,
                    condition: 'below',
                    risks: ['Heavy metal poisoning', 'Dental erosion and tooth decay', 'Digestive irritation and acid reflux', 'Skin and hair problems', 'Mineral deficiencies', 'Corrosion of pipes leading to metal contamination']
                },
                low: { // 4 - 6.5
                    threshold: 6.5,
                    condition: 'below',
                    risks: ['Metallic taste', 'Pipe corrosion', 'Potential copper and lead contamination', 'Stomach discomfort']
                },
                high: { // 8.5 - 10
                    threshold: 10,
                    condition: 'between',
                    lowerBound: 8.5,
                    risks: ['Bitter taste', 'Skin irritation and dryness', 'Eye irritation', 'Reduced disinfection effectiveness', 'Scale buildup in pipes']
                },
                veryHigh: { // > 10
                    threshold: 10,
                    condition: 'above',
                    risks: ['Severe gastrointestinal issues', 'Skin burns and rashes', 'Eye damage', 'Nausea and vomiting', 'Potential tissue damage']
                }
            },
            hardness: {
                high: { // > 300
                    threshold: 300,
                    condition: 'above',
                    risks: ['Kidney stone formation', 'Cardiovascular issues (disputed)', 'Dry and itchy skin', 'Scale buildup affecting appliances', 'Reduced soap effectiveness']
                },
                veryHigh: { // > 500
                    threshold: 500,
                    condition: 'above',
                    risks: ['Increased risk of kidney stones', 'Digestive discomfort', 'Potential mineral buildup in body', 'Severe plumbing damage']
                }
            },
            organic_carbon: {
                high: { // > 20
                    threshold: 20,
                    condition: 'above',
                    risks: ['Formation of harmful disinfection byproducts', 'Increased risk of cancer (with chlorination)', 'Bacterial growth promotion', 'Unpleasant taste and odor', 'Liver and kidney stress']
                },
                veryHigh: { // > 30
                    threshold: 30,
                    condition: 'above',
                    risks: ['Significantly increased cancer risk', 'Serious gastrointestinal issues', 'Liver toxicity', 'Neurological effects', 'Immune system suppression']
                }
            },
            conductivity: {
                high: { // > 800
                    threshold: 800,
                    condition: 'above',
                    risks: ['High mineral content', 'Salty or metallic taste', 'Laxative effects', 'Dehydration risk', 'Potential contamination indicator']
                },
                veryHigh: { // > 1200
                    threshold: 1200,
                    condition: 'above',
                    risks: ['Severe dehydration', 'Electrolyte imbalance', 'Kidney strain', 'Hypertension risk', 'Industrial contamination likely']
                }
            },
            turbidity: {
                high: { // > 5
                    threshold: 5,
                    condition: 'above',
                    risks: ['Harbors harmful microorganisms', 'Reduced disinfection effectiveness', 'Gastrointestinal illnesses', 'Parasitic infections (Giardia, Cryptosporidium)', 'Cholera and dysentery risk']
                },
                veryHigh: { // > 10
                    threshold: 10,
                    condition: 'above',
                    risks: ['High risk of waterborne diseases', 'Severe bacterial and viral infections', 'Parasitic diseases', 'Typhoid fever risk', 'Hepatitis A risk', 'Chemical contaminant carrier']
                }
            }
        };

        // API endpoint - change this to your deployed backend URL
        const API_URL = 'http://localhost:5000/api/predict';
        
        // Predict using Flask API
        async function predictPotability(data) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Error calling API:', error);
                // Fallback to local prediction if API fails
                return localPrediction(data);
            }
        }
        
        // Fallback local prediction
        function localPrediction(data) {
            let score = 0;
            let criticalIssues = false;
            
            // pH scoring with critical check
            if (data.ph >= 6.5 && data.ph <= 8.5) {
                score += 20;
            } else if (data.ph >= 6.0 && data.ph <= 9.0) {
                score += 10;
            } else if (data.ph < 4 || data.ph > 10) {
                criticalIssues = true; // Critical pH levels
            }
            
            // Hardness scoring
            if (data.hardness <= 300) {
                score += 20;
            } else if (data.hardness <= 400) {
                score += 10;
            } else if (data.hardness > 500) {
                criticalIssues = true; // Very high hardness
            }
            
            // Organic carbon scoring
            if (data.organic_carbon <= 20) {
                score += 20;
            } else if (data.organic_carbon <= 30) {
                score += 10;
            } else if (data.organic_carbon > 30) {
                criticalIssues = true; // Very high organic carbon
            }
            
            // Conductivity scoring
            if (data.conductivity <= 800) {
                score += 20;
            } else if (data.conductivity <= 1000) {
                score += 10;
            } else if (data.conductivity > 1200) {
                criticalIssues = true; // Very high conductivity
            }
            
            // Turbidity scoring
            if (data.turbidity <= 5) {
                score += 20;
            } else if (data.turbidity <= 10) {
                score += 10;
            } else if (data.turbidity > 10) {
                criticalIssues = true; // Very high turbidity
            }
            
            // If there are critical issues, water is NOT potable regardless of score
            const isPotable = !criticalIssues && score >= 70;
            
            return {
                prediction: isPotable ? 1 : 0,
                probability: criticalIssues ? 0 : score / 100,
                message: isPotable ? 'Water is POTABLE' : 'Water is NOT POTABLE'
            };
        }

        function getParameterStatus(param, value) {
            const range = safeRanges[param];
            if (value >= range.min && value <= range.max) {
                return 'safe';
            } else if (value >= range.min * 0.8 && value <= range.max * 1.2) {
                return 'warning';
            }
            return 'danger';
        }

        function getHealthRisks(param, value) {
            const risks = healthRisks[param];
            if (!risks) return null;

            let applicableRisks = [];

            // Check pH levels
            if (param === 'ph') {
                if (value < risks.veryLow.threshold) {
                    applicableRisks = risks.veryLow.risks;
                } else if (value < risks.low.threshold) {
                    applicableRisks = risks.low.risks;
                } else if (value > risks.veryHigh.threshold) {
                    applicableRisks = risks.veryHigh.risks;
                } else if (value > risks.high.lowerBound) {
                    applicableRisks = risks.high.risks;
                }
            } 
            // Check other parameters
            else {
                if (risks.veryHigh && value > risks.veryHigh.threshold) {
                    applicableRisks = risks.veryHigh.risks;
                } else if (risks.high && value > risks.high.threshold) {
                    applicableRisks = risks.high.risks;
                }
            }

            return applicableRisks.length > 0 ? applicableRisks : null;
        }

        function displayParameterAnalysis(data) {
            const parameterList = document.getElementById('parameterList');
            parameterList.innerHTML = '';

            const params = [
                { key: 'ph', name: 'pH Level', value: data.ph },
                { key: 'hardness', name: 'Hardness', value: data.hardness },
                { key: 'organic_carbon', name: 'Organic Carbon', value: data.organic_carbon },
                { key: 'conductivity', name: 'Conductivity', value: data.conductivity },
                { key: 'turbidity', name: 'Turbidity', value: data.turbidity }
            ];

            params.forEach(param => {
                const status = getParameterStatus(param.key, param.value);
                const statusClass = status === 'safe' ? 'status-safe' : status === 'warning' ? 'status-warning' : 'status-danger';
                const statusText = status === 'safe' ? '‚úì Safe' : status === 'warning' ? '‚ö† Warning' : '‚úó Unsafe';

                const div = document.createElement('div');
                div.className = 'parameter-item';
                div.innerHTML = `
                    <span class="parameter-name">${param.name}</span>
                    <span class="parameter-value">${param.value.toFixed(2)} ${safeRanges[param.key].unit}</span>
                    <span class="parameter-status ${statusClass}">${statusText}</span>
                `;
                parameterList.appendChild(div);

                // Add health risks if parameter is unsafe
                const risks = getHealthRisks(param.key, param.value);
                if (risks && risks.length > 0) {
                    const riskDiv = document.createElement('div');
                    riskDiv.className = 'health-risks';
                    riskDiv.innerHTML = `
                        <div class="risk-title">‚ö†Ô∏è Potential Health Risks:</div>
                        <ul class="risk-list">
                            ${risks.map(risk => `<li>${risk}</li>`).join('')}
                        </ul>
                    `;
                    parameterList.appendChild(riskDiv);
                }
            });

            document.getElementById('parameterAnalysis').style.display = 'block';
        }

        function updateChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            const labels = testHistory.map((_, i) => `Test ${i + 1}`);
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'pH Level',
                        data: testHistory.map(t => t.ph),
                        borderColor: '#667eea',
                        tension: 0.4
                    }, {
                        label: 'Turbidity (NTU)',
                        data: testHistory.map(t => t.turbidity),
                        borderColor: '#764ba2',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        document.getElementById('waterForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const data = {
                ph: parseFloat(document.getElementById('ph').value),
                hardness: parseFloat(document.getElementById('hardness').value),
                organic_carbon: parseFloat(document.getElementById('organic_carbon').value),
                conductivity: parseFloat(document.getElementById('conductivity').value),
                turbidity: parseFloat(document.getElementById('turbidity').value)
            };

            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Analyzing...';
            submitBtn.disabled = true;

            const result = await predictPotability(data);
            const resultCard = document.getElementById('resultCard');
            const resultText = document.getElementById('resultText');

            testCount++;
            if (result.prediction === 1 || result.potable) potableCount++;

            testHistory.push(data);
            if (testHistory.length > 10) testHistory.shift();

            resultCard.style.display = 'block';
            if (result.prediction === 1 || result.potable) {
                resultCard.className = 'result-card potable';
                resultCard.querySelector('.result-icon').textContent = '‚úÖ';
                resultText.innerHTML = result.message + (result.probability ? `<br><small>Confidence: ${(result.probability * 100).toFixed(1)}%</small>` : '');
            } else {
                resultCard.className = 'result-card not-potable';
                resultCard.querySelector('.result-icon').textContent = '‚ùå';
                resultText.innerHTML = result.message + (result.probability ? `<br><small>Confidence: ${(result.probability * 100).toFixed(1)}%</small>` : '');
            }

            displayParameterAnalysis(data);
            document.getElementById('testCount').textContent = testCount;
            document.getElementById('potableCount').textContent = potableCount;
            updateChart();

            // Reset button
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;

            resultCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        });

        function fillSampleData() {
            document.getElementById('ph').value = '7.2';
            document.getElementById('hardness').value = '180';
            document.getElementById('organic_carbon').value = '12.5';
            document.getElementById('conductivity').value = '450';
            document.getElementById('turbidity').value = '3.8';
        }

        // Initialize empty chart
        updateChart();
    </script>
</body>
</html>